{% extends "layout.html" %}
{% block title %}{{ summit.format_name() }} {% endblock %}
{% block description %}Вершина {{ summit.format_name() }} хребта {{ summit.ridge }} &mdash; расшифровка названия, высота, координаты{% endblock %}
{% block content %}
{% with messages = get_flashed_messages() %}
  {% if messages %}
<div class="alert alert-success" role="alert">
    {% for message in messages %}
      {{ message }}
    {% endfor %}
</div>
  {% endif %}
{% endwith %}
<h1>
{{ summit.format_name() }} 
{% if current_user.admin %}
<a href="{{ url_for('summit_edit', summit_id=summit.id) }}"><span class="glyphicon glyphicon-edit"></span></a>
<a href="{{ url_for('summit_delete', summit_id=summit.id) }}" class="simple-delete-confirm"><span class="glyphicon glyphicon-remove"></span></a>
{% endif %}
</h1>
{% if summit.name_alt %}
<dl class="dl-horizontal">
    <dt>Варианты названий</dt>
    <dd>{{ summit.name_alt }}</dd>
</dl>
{% endif %}
<dl class="dl-horizontal">
    <dt>Высота</dt>
    <dd>{{ summit.height }}</dd>
</dl>
<dl class="dl-horizontal">
    <dt>Хребет</dt>
    <dd>{{ summit.ridge }}</dd>
</dl>
<dl class="dl-horizontal">
    <dt>Координаты</dt>
    <dd><a href="{{ url_for('index', sid=summit.id) }}#12/{{ summit.coordinates[0] }}/{{ summit.coordinates[1] }}">{{ summit.format_coordinates() }}</a></dd>
</dl>
{% if summit.interpretation %}
<dl class="dl-horizontal">
    <dt>Расшифровка названия</dt>
    <dd>{{ summit.interpretation | safe }}</dd>
</dl>
{% endif %}
{% if summit.description %}
<dl class="dl-horizontal">
    <dt>Дополнительная информация</dt>
    <dd>{{ summit.description | safe }}</dd>
</dl>
{% endif %}
{% if not current_user.is_authenticated %}
    <dl class="dl-horizontal">
        <dd><a class="btn btn-primary" href="{{ url_for('login_form', r=url_for('climb_new', summit_id=summit.id)) }}" data-remote="false" data-toggle="modal" data-target="#authModal">Взошли на эту вершину?</a></dd>
    </dl>
{% elif climbers | length  == 0 or current_user != climbers[0]['user'] %}
    <dl class="dl-horizontal">
        <dd><a class="btn btn-primary" href="{{ url_for('climb_new', summit_id=summit.id) }}">Взошли на эту вершину?</a></dd>
    </dl>
{% endif %}
<h3>
    Восходители
</h3>
{% if climbers | length == 0 %}
Никто пока не сообщил о восхождении на эту вершину.
{% endif %}
<ul class="media-list">
    {% for c in climbers %}
    <li class="media">
    <div class="media-left">
        <a href="{{ url_for('user', user_id=c['user'].id) }}">
        {% if c['user'].preview_id %}
        <img src="{{ url_for("image_get", image_id=c['user'].preview_id)}}" class="media-object">
        {% else %}
        <img src="/static/climber_sm.png" class="media-object">
        {% endif %}
        </a>
    </div>
    <div class="media-body">
        <h4 class="media-heading">
            <a href="{{ url_for('user', user_id=c['user'].id) }}">{{ c['user'].name }}</a> 
        </h4>
        {% if c['date'] %}<div class="text-muted"><i>{{ c['date'].format() }}</i></div>{% endif %}
        {% if c['comment'] %}{{ c['comment'] }}{% endif %}
        {% if c['user'] == current_user %}
        <div>
        <small><a href="{{ url_for('summit_climb_edit', summit_id=summit.id) }}">Редактировать</a></small>
        <small><a href="{{ url_for('summit_climb_delete', summit_id=summit.id) }}" class="simple-delete-confirm">Удалить</a></small>
        </div>
        {% endif %}
    </div>
    </li>
    {% endfor %}
</ul>
{% endblock %}
